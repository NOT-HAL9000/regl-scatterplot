var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;import{c as r,b as a,d as l,l as s,q as c,e as d,f as u,g as p,p as m,i as h,w as g,h as y,j as v,t as f,k as w,n as x,m as b,o as S,r as C,u as E,s as I,v as M,x as A,y as R,K as P,z as T,A as z,C as B,D}from"./vendor.de749451.js";const O="auto",L=Float32Array.BYTES_PER_ELEMENT,k=["OES_texture_float","OES_element_index_uint","WEBGL_color_buffer_float","EXT_float_blend"],_={color:[0,0,0,0],depth:1},N=["panZoom","lasso","rotate"],$="panZoom",F={cubicIn:a,cubicInOut:r,cubicOut:l,linear:s,quadIn:c,quadInOut:d,quadOut:u},W=r,j=["deselect","lassoEnd"],Z=[0,.666666667,1,1],V=2,q=!1,G=10,H=3,K="lassoEnd",Y=["lasso","rotate","merge"],X=["alt","cmd","ctrl","meta","shift"],U={alt:"rotate",shift:"lasso",cmd:"merge"},J=O,Q=O,ee=1,te=6,ne=2,oe=2,ie=null,re=2,ae=2,le=null,se=null,ce=null,de=.66,ue=null,pe=.15,me=25,he=1,ge=1,ye=null,ve=[.66,.66,.66,1],fe=[0,.55,1,1],we=[1,1,1,1],xe=[0,0,0,1],be=null,Se=[.66,.66,.66,.2],Ce=[0,.55,1,1],Ee=[1,1,1,1],Ie=[0,0],Me=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ae=null,Re=!1,Pe=[1,1,1,.5],Te=!0,ze=!0,Be=!1,De=100,Oe=.002,Le="auto",ke=!1,_e=new Set(["z","valueZ","valueA","value1","category"]),Ne=new Set(["w","valueW","valueB","value2","value"]),$e=(e,t,n,o)=>Math.sqrt((e-n)**2+(t-o)**2),Fe=(e,t=!1)=>e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((e,t,n,o)=>`#${t}${t}${n}${n}${o}${o}`)).substring(1).match(/.{2}/g).map((e=>parseInt(e,16)/255**t)),We=(e,t,{minLength:n=0}={})=>Array.isArray(e)&&e.length>=n&&e.every(t),je=e=>!Number.isNaN(+e)&&+e>=0,Ze=e=>!Number.isNaN(+e)&&+e>0,Ve=(e,t)=>n=>e.indexOf(n)>=0?n:t,qe=(e,t)=>new Promise(((n,o)=>{((e,t=!1)=>new Promise(((n,o)=>{const i=new Image;t&&(i.crossOrigin="anonymous"),i.src=e,i.onload=()=>{n(i)},i.onerror=e=>{o(e)}})))(t,0!==t.indexOf(window.location.origin)&&-1===t.indexOf("base64")).then((t=>{n(e.texture(t))})).catch((e=>{o(e)}))})),Ge=e=>e>=0&&e<=1,He=e=>Array.isArray(e)&&e.every(Ge),Ke=e=>"string"==typeof e||e instanceof String,Ye=e=>Number.isInteger(e)&&e>=0&&e<=255,Xe=e=>Array.isArray(e)&&e.every(Ye),Ue=e=>Array.isArray(e)&&e.length&&(Array.isArray(e[0])||Ke(e[0])),Je=(e,t)=>e>t?e:t,Qe=(e,t)=>e<t?e:t,et=(e,t)=>{if(4===(n=e).length&&(He(n)||Xe(n))){const n=He(e);return t&&n||!t&&!n?e:t&&!n?e.map((e=>e/255)):e.map((e=>255*e))}var n,o;if(3===(o=e).length&&(He(o)||Xe(o))){const n=255**!t,o=He(e);return t&&o||!t&&!o?[...e,n]:t&&!o?[...e.map((e=>e/255)),n]:[...e.map((e=>255*e)),n]}return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)?((e,t=!1)=>[...Fe(e,t),255**!t])(e,t):(console.warn("Only HEX, RGB, and RGBA are handled by this function. Returning white instead."),t?[1,1,1,1]:[255,255,255,255])},tt=e=>Object.entries(e).reduce(((e,[t,n])=>(e[n]?e[n]=[...e[n],t]:e[n]=t,e)),{}),nt=e=>.21*e[0]+.72*e[1]+.07*e[2],ot=(e={})=>{let{regl:t,canvas:n=document.createElement("canvas"),gamma:o=ee}=e;t||(t=(e=>{const t=e.getContext("webgl",{antialias:!0,preserveDrawingBuffer:!0}),n=[];return k.forEach((e=>{t.getExtension(e)?n.push(e):console.warn(`WebGL: ${e} extension not supported. Scatterplot might not render properly`)})),p({gl:t,extensions:n})})(n));const i=((e,t)=>!!e&&k.reduce(((n,o)=>e.hasExtension(o)?n:(t||console.warn(`WebGL: ${o} extension not supported. Scatterplot might not render properly`),!1)),!0))(t),r=[n.width,n.height],a=t.framebuffer({width:r[0],height:r[1],colorFormat:"rgba",colorType:"float"}),l=t({vert:"\n      precision highp float;\n      attribute vec2 xy;\n      void main () {\n        gl_Position = vec4(xy, 0, 1);\n      }",frag:"\n      precision highp float;\n      uniform vec2 srcRes;\n      uniform sampler2D src;\n      uniform float gamma;\n\n      vec3 approxLinearToSRGB (vec3 rgb, float gamma) {\n        return pow(clamp(rgb, vec3(0), vec3(1)), vec3(1.0 / gamma));\n      }\n\n      void main () {\n        vec4 color = texture2D(src, gl_FragCoord.xy / srcRes);\n        gl_FragColor = vec4(approxLinearToSRGB(color.rgb, gamma), color.a);\n      }",attributes:{xy:[-4,-4,4,-4,0,4]},uniforms:{src:()=>a,srcRes:()=>r,gamma:()=>o},count:3,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}}}),s=new Set,c=t.frame((()=>{const e=s.values();let t=e.next();for(;!t.done;)t.value(),t=e.next()})),d=()=>{n.width=window.innerWidth*window.devicePixelRatio,n.height=window.innerHeight*window.devicePixelRatio,r[0]=n.width,r[1]=n.height,a.resize(...r)};e.canvas||(window.addEventListener("resize",d),window.addEventListener("orientationchange",d),d());return{get canvas(){return n},get regl(){return t},get gamma(){return o},set gamma(e){o=+e},get isSupported(){return i},render:(e,o)=>{t.clear(_),a.use((()=>{t.clear(_),e(o.width/n.width,o.height/n.height)})),l(),(e=>{const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.drawImage(n,(n.width-e.width)/2,(n.height-e.height)/2,e.width,e.height,0,0,e.width,e.height)})(o)},onFrame:e=>(s.add(e),()=>{s.delete(e)}),refresh:()=>{t.poll()},destroy:()=>{c.cancel(),n=void 0,t=void 0,window.removeEventListener("resize",d),window.removeEventListener("orientationchange",d)}}},it=(e,t=null)=>null===e?t:e,rt=document.createElement("style");document.head.appendChild(rt);const at=rt.sheet,lt=e=>{const t=at.rules.length;return at.insertRule(e,t),t},st=e=>{at.deleteRule(e)};let ct=null;let dt=null;const ut=(e,{onDraw:t=h,onStart:n=h,onEnd:o=h,enableInitiator:i=true,initiatorParentElement:r=document.body,minDelay:a=8,minDist:l=2,pointNorm:s=h}={})=>{let c=i,d=r,u=t,p=n,S=o,C=s;const E=document.createElement("div"),I=Math.random().toString(36).substring(2,5)+Math.random().toString(36).substring(2,5);E.id=`lasso-initiator-${I}`,E.style.position="fixed",E.style.display="flex",E.style.justifyContent="center",E.style.alignItems="center",E.style.zIndex=99,E.style.width="4rem",E.style.height="4rem",E.style.borderRadius="4rem",E.style.opacity=.5,E.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)";let M,A=!1,R=!1,P=[],T=[];const z=()=>{A=!1};window.addEventListener("mouseup",z);const B=()=>{E.style.opacity=.5,E.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)"},D=()=>{const e=getComputedStyle(E),t=+e.opacity,n=e.transform.match(/([0-9.-]+)+/g),o=+n[0],i=+n[1];return{opacity:t,scale:Math.sqrt(o*o+i*i),rotate:Math.atan2(i,o)*(180/Math.PI)}},O=e=>{c&&w(0).then((()=>{const t=e.clientX,n=e.clientY;if(A)return;let o=.5,i=0,r=0;const a=D();o=a.opacity,i=a.scale,r=a.rotate,E.style.opacity=o,E.style.transform=`translate(-50%,-50%) scale(${i}) rotate(${r}deg)`,E.style.animation="none",x(2).then((()=>{E.style.top=`${n}px`,E.style.left=`${t}px`,null!==ct&&st(ct),ct=lt(((e,t,n)=>`\n@keyframes scaleInFadeOut {\n  0% {\n    opacity: ${e};\n    transform: translate(-50%,-50%) scale(${t}) rotate(${n}deg);\n  }\n  10% {\n    opacity: 1;\n    transform: translate(-50%,-50%) scale(1) rotate(${n+20}deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0.9) rotate(${n+60}deg);\n  }\n}\n`)(o,i,r)),E.style.animation="2500ms ease scaleInFadeOut 0s 1 normal backwards",x().then((()=>{B()}))}))}))},L=()=>{const{opacity:e,scale:t,rotate:n}=D();E.style.opacity=e,E.style.transform=`translate(-50%,-50%) scale(${t}) rotate(${n}deg)`,E.style.animation="none",x(2).then((()=>{null!==dt&&st(dt),dt=lt(((e,t,n)=>`\n@keyframes fadeScaleOut {\n  0% {\n    opacity: ${e};\n    transform: translate(-50%,-50%) scale(${t}) rotate(${n}deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0) rotate(${n}deg);\n  }\n}\n`)(e,t,n)),E.style.animation="250ms ease fadeScaleOut 0s 1 normal backwards",x().then((()=>{B()}))}))},k=()=>{u(P,T)},_=e=>{if(M){if(b(e[0],e[1],M[0],M[1])>2){M=e;const t=C(e);P.push(t),T.push(t[0],t[1]),P.length>1&&k()}}else{R||(R=!0,p()),M=e;const t=C(e);P=[t],T=[t[0],t[1]]}},N=f(_,8,8),$=(t,n)=>{const o=(t=>{const{left:n,top:o}=e.getBoundingClientRect();return[t.clientX-n,t.clientY-o]})(t);return n?N(o):_(o)},F=()=>{P=[],T=[],M=void 0,k()},W=e=>{O(e)},j=()=>{A=!0,R=!0,F(),p()},Z=()=>{L()},V=({merge:e=!1}={})=>{R=!1;const t=[...P],n=[...T];return N.cancel(),F(),t.length&&S(t,n,{merge:e}),t},q=({onDraw:e=null,onStart:t=null,onEnd:n=null,enableInitiator:o=null,initiatorParentElement:i=null,minDelay:r=null,minDist:a=null,pointNorm:l=null}={})=>{u=it(e,u),p=it(t,p),S=it(n,S),c=it(o,c),C=it(l,C),null!==i&&i!==d&&(d.removeChild(E),i.appendChild(E),d=i),c?(E.addEventListener("click",W),E.addEventListener("mousedown",j),E.addEventListener("mouseleave",Z)):(E.removeEventListener("mousedown",j),E.removeEventListener("mouseleave",Z))},G=()=>{d.removeChild(E),window.removeEventListener("mouseup",z),E.removeEventListener("click",W),E.removeEventListener("mousedown",j),E.removeEventListener("mouseleave",Z)};return d.appendChild(E),q({onDraw:u,onStart:p,onEnd:S,enableInitiator:c,initiatorParentElement:d}),m(v("initiator",E),(e=>y(e,{clear:F,destroy:G,end:V,extend:$,set:q,showInitiator:O,hideInitiator:L})),g(ut))({})},pt=e=>`\nprecision highp float;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform sampler2D stateTex;\nuniform float stateTexRes;\nuniform float stateTexEps;\nuniform float devicePixelRatio;\nuniform sampler2D encodingTex;\nuniform float encodingTexRes;\nuniform float encodingTexEps;\nuniform float pointSizeExtra;\nuniform float pointOpacityMax;\nuniform float pointOpacityScale;\nuniform float numPoints;\nuniform float globalState;\nuniform float isColoredByZ;\nuniform float isColoredByW;\nuniform float isOpacityByZ;\nuniform float isOpacityByW;\nuniform float isOpacityByDensity;\nuniform float isSizedByZ;\nuniform float isSizedByW;\nuniform float colorMultiplicator;\nuniform float opacityMultiplicator;\nuniform float opacityDensity;\nuniform float sizeMultiplicator;\nuniform float numColorStates;\nuniform float pointScale;\nuniform mat4 modelViewProjection;\n\nattribute vec2 stateIndex;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nvoid main() {\n  vec4 state = texture2D(stateTex, stateIndex);\n\n  gl_Position = modelViewProjection * vec4(state.x, state.y, 0.0, 1.0);\n\n  // Determine color index\n  float colorIndexZ =  isColoredByZ * floor(state.z * colorMultiplicator);\n  float colorIndexW =  isColoredByW * floor(state.w * colorMultiplicator);\n\n  // Multiply by the number of color states per color\n  // I.e., normal, active, hover, background, etc.\n  float colorIndex = (colorIndexZ + colorIndexW) * numColorStates;\n\n  // Half a "pixel" or "texel" in texture coordinates\n  float colorLinearIndex = colorIndex + globalState;\n\n  // Need to add cEps here to avoid floating point issue that can lead to\n  // dramatic changes in which color is loaded as floor(3/2.9999) = 1 but\n  // floor(3/3.0001) = 0!\n  float colorRowIndex = floor((colorLinearIndex + colorTexEps) / colorTexRes);\n\n  vec2 colorTexIndex = vec2(\n    (colorLinearIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n\n  // Retrieve point size\n  float pointSizeIndexZ = isSizedByZ * floor(state.z * sizeMultiplicator);\n  float pointSizeIndexW = isSizedByW * floor(state.w * sizeMultiplicator);\n  float pointSizeIndex = pointSizeIndexZ + pointSizeIndexW;\n\n  float pointSizeRowIndex = floor((pointSizeIndex + encodingTexEps) / encodingTexRes);\n  vec2 pointSizeTexIndex = vec2(\n    (pointSizeIndex / encodingTexRes) - pointSizeRowIndex + encodingTexEps,\n    pointSizeRowIndex / encodingTexRes + encodingTexEps\n  );\n  float pointSize = texture2D(encodingTex, pointSizeTexIndex).x;\n\n  // Retrieve opacity\n  ${3===e?"":`\n        if (isOpacityByDensity < 0.5) {\n          float opacityIndexZ = isOpacityByZ * floor(state.z * opacityMultiplicator);\n          float opacityIndexW = isOpacityByW * floor(state.w * opacityMultiplicator);\n          float opacityIndex = opacityIndexZ + opacityIndexW;\n\n          float opacityRowIndex = floor((opacityIndex + encodingTexEps) / encodingTexRes);\n          vec2 opacityTexIndex = vec2(\n            (opacityIndex / encodingTexRes) - opacityRowIndex + encodingTexEps,\n            opacityRowIndex / encodingTexRes + encodingTexEps\n          );\n          color.a = texture2D(encodingTex, opacityTexIndex)[${1+e}];\n        } else {\n          color.a = min(1.0, opacityDensity + globalState);\n        }\n      `}\n\n  color.a = min(pointOpacityMax, color.a) * pointOpacityScale;\n  finalPointSize = (pointSize * pointScale) + pointSizeExtra;\n  gl_PointSize = finalPointSize;\n}\n`,mt=function(){const e=(e,t,n,o,i)=>{const r=.5*(o-t),a=.5*(i-n);return(2*n-2*o+r+a)*e*e*e+(-3*n+3*o-2*r-a)*e*e+r*e+n},t=(t,n,o)=>{const i=o*t,r=Math.floor(i),a=i-r,l=n[Math.max(0,r-1)],s=n[r],c=n[Math.min(o,r+1)],d=n[Math.min(o,r+2)];return[e(a,l[0],s[0],c[0],d[0]),e(a,l[1],s[1],c[1],d[1])]},n=(e,t,n)=>{let o=t[0],i=t[1],r=n[0]-o,a=n[1]-i;if(0!==r||0!==a){const t=((e[0]-o)*r+(e[1]-i)*a)/(r*r+a*a);t>1?(o=n[0],i=n[1]):t>0&&(o+=r*t,i+=a*t)}return r=e[0]-o,a=e[1]-i,r*r+a*a},o=(e,t,i,r,a)=>{let l,s=r;for(let o=t+1;o<i;o++){const r=n(e[o],e[t],e[i]);r>s&&(l=o,s=r)}s>r&&(l-t>1&&o(e,t,l,r,a),a.push(e[l]),i-l>1&&o(e,l,i,r,a))},i=(e,t)=>{const n=e.length-1,i=[e[0]];return o(e,0,n,t,i),i.push(e[n]),i};self.onmessage=function(e){(e.data.points?+e.data.points.length:0)||self.postMessage({error:new Error("No points provided")}),e.data.points;const n=(e=>{const t={},n=!Number.isNaN(+e[0][5]);return e.forEach((e=>{const o=e[4];t[o]||(t[o]=[]),n?t[o][e[5]]=e:t[o].push(e)})),Object.entries(t).forEach((e=>{t[e[0]]=e[1].filter((e=>e)),t[e[0]].reference=e[1][0]})),t})(e.data.points);self.postMessage({points:Object.entries(n).reduce(((n,o)=>(n[o[0]]=((e,{maxIntPointsPerSegment:n=100,tolerance:o=.002}={})=>{const r=e.length,a=r-1,l=a*n+1,s=o**2;let c,d=[];for(let m=0;m<r-1;m++){let o=[e[m].slice(0,2)];c=e[m];for(let i=1;i<n;i++){const r=t((m*n+i)/l,e,a);u=c[0],p=c[1],(u-r[0])**2+(p-r[1])**2>s&&(o.push(r),c=r)}o.push(e[m+1]),o=i(o,s),d=d.concat(o.slice(0,o.length-1))}var u,p;
/**
   * Douglas Peucker square segment distance
   * Implementation from https://github.com/mourner/simplify-js
   * @author Vladimir Agafonkin
   * @copyright Vladimir Agafonkin 2013
   * @license BSD
   * @param {array} p - Point
   * @param {array} p1 - First boundary point
   * @param {array} p2 - Second boundary point
   * @return {number} Distance
   */return d.push(e[e.length-1].slice(0,2)),d.flat()})(o[1],e.data.options),n[o[0]].reference=o[1].reference,n)),{})})}},ht={showRecticle:"showReticle",recticleColor:"reticleColor"},gt=e=>{Object.keys(e).filter((e=>ht[e])).forEach((t=>{console.warn(`regl-scatterplot: the "${t}" property is deprecated. Please use "${ht[t]}" instead.`),e[ht[t]]=e[t],delete e[t]}))},yt=(e,t,{allowSegment:n=!1,allowDensity:o=!1}={})=>_e.has(e)?"valueZ":Ne.has(e)?"valueW":"segment"===e?n?"segment":t:"density"===e&&o?"density":t,vt=e=>{switch(e){case"valueZ":return 2;case"valueW":return 3;default:return null}},ft=(e={})=>{const r=C({async:!e.syncEvents,caseInsensitive:!0}),a=new Float32Array(16),l=new Float32Array(16),s=[0,0];gt(e);let{renderer:c,backgroundColor:d=xe,backgroundImage:u=Ae,canvas:p=document.createElement("canvas"),colorBy:m=ye,deselectOnDblClick:g=Te,deselectOnEscape:y=ze,lassoColor:v=Z,lassoLineWidth:w=V,lassoMinDelay:x=G,lassoMinDist:b=H,lassoClearEvent:k=K,lassoInitiator:_=q,lassoInitiatorParentElement:ee=document.body,keyMap:Fe=U,mouseMode:Ge=$,showReticle:He=Re,reticleColor:Ye=Pe,pointColor:Xe=ve,pointColorActive:it=fe,pointColorHover:rt=we,showPointConnections:at=Be,pointConnectionColor:lt=Se,pointConnectionColorActive:st=Ce,pointConnectionColorHover:ct=Ee,pointConnectionColorBy:dt=be,pointConnectionOpacity:ht=se,pointConnectionOpacityBy:ft=ce,pointConnectionOpacityActive:wt=de,pointConnectionSize:xt=re,pointConnectionSizeActive:bt=ae,pointConnectionSizeBy:St=le,pointConnectionMaxIntPointsPerSegment:Ct=De,pointConnectionTolerance:Et=Oe,pointSize:It=te,pointSizeSelected:Mt=ne,pointSizeMouseDetection:At=Le,pointOutlineWidth:Rt=oe,opacity:Pt=O,opacityBy:Tt=ue,opacityByDensityFill:zt=pe,opacityInactiveMax:Bt=he,opacityInactiveScale:Dt=ge,sizeBy:Ot=ie,height:Lt=Q,width:kt=J}=e,_t=kt===O?1:kt,Nt=Lt===O?1:Lt;const{performanceMode:$t=ke,opacityByDensityDebounceTime:Ft=me}=e;c||(c=ot({regl:e.regl,gamma:e.gamma})),d=et(d,!0),v=et(v,!0),Ye=et(Ye,!0);let Wt,jt,Zt=nt(d),Vt=!1,qt=[];const Gt=new Set,Ht=new Set;let Kt,Yt,Xt,Ut,Jt,Qt,en,tn,nn,on,rn,an,ln,sn,cn,dn=null,un=[0,0],pn=0,mn=0,hn=!1,gn=[],yn=1,vn=tt(Fe),fn=!1,wn=!0,xn=!1;Xe=Ue(Xe)?[...Xe]:[Xe],it=Ue(it)?[...it]:[it],rt=Ue(rt)?[...rt]:[rt],Xe=Xe.map((e=>et(e,!0))),it=it.map((e=>et(e,!0))),rt=rt.map((e=>et(e,!0))),Pt=!Array.isArray(Pt)&&Number.isNaN(+Pt)?Xe[0][3]:Pt,Pt=We(Pt,je,{minLength:1})?[...Pt]:[Pt],It=We(It,je,{minLength:1})?[...It]:[It];let bn,Sn,Cn,En,In=1/It[0];"inherit"===lt?lt=[...Xe]:(lt=Ue(lt)?[...lt]:[lt],lt=lt.map((e=>et(e,!0)))),"inherit"===st?st=[...it]:(st=Ue(st)?[...st]:[st],st=st.map((e=>et(e,!0)))),"inherit"===ct?ct=[...rt]:(ct=Ue(ct)?[...ct]:[ct],ct=ct.map((e=>et(e,!0)))),ht="inherit"===ht?[...Pt]:We(ht,je,{minLength:1})?[...ht]:[ht],xt="inherit"===xt?[...It]:We(xt,je,{minLength:1})?[...xt]:[xt],m=yt(m,ye),Tt=yt(Tt,ue,{allowDensity:!0}),Ot=yt(Ot,ie),dt=yt(dt,be,{allowSegment:!0}),ft=yt(ft,ce,{allowSegment:!0}),St=yt(St,le,{allowSegment:!0});let Mn,An,Rn,Pn,Tn,zn,Bn,Dn,On,Ln,kn,_n,Nn=0,$n=0,Fn=!1,Wn=null,jn=He,Zn=0,Vn=0,qn=!1,Gn=!1,Hn=0,Kn=0,Yn=!1,Xn=e.xScale||null,Un=e.yScale||null,Jn=0,Qn=0,eo=0,to=0;Xn&&(Jn=Xn.domain()[0],Qn=Xn.domain()[1]-Xn.domain()[0],Xn.range([0,_t])),Un&&(eo=Un.domain()[0],to=Un.domain()[1]-Un.domain()[0],Un.range([Nt,0]));const no=e=>e/_t*2-1,oo=e=>1+e/Nt*-2,io=(e,t)=>{const n=[e,t,1,1],o=I(a,M(a,Xt,M(a,Wt.view,Jt)));return A(n,n,o),n.slice(0,2)},ro=()=>{const e=ei(),t=ln[1]-sn[1];return rn*e*(t/Nt)*.66},ao=()=>{const[e,t]=[no(s[0]),oo(s[1])],[n,o]=io(e,t),i=ro(),r=Kt.range(n-i,o-i,n+i,o+i);let a,l=i;return r.forEach((e=>{const[t,i]=Kt.points[e],r=$e(t,i,n,o);r<l&&(l=r,a=e)})),l<rn/_t*2?a:-1},lo=()=>{gn=[],jt&&jt.clear()},so=e=>e&&e.length>4,co=(e,t)=>{if(tn||!at||!so(Kt.points[e[0]]))return;const n=0===t,o=1===t?e=>Ht.add(e):h,i=Object.keys(e.reduce(((e,t)=>{const n=Kt.points[t];return e[Array.isArray(n[4])?n[4][0]:n[4]]=!0,e}),{})),r=Qt.getData().opacities;i.filter((e=>!Ht.has(+e))).forEach((e=>{const t=en[e][0],i=en[e][2],a=4*t+2*en[e][3],l=a+2*i+4;void 0===r.__original__&&(r.__original__=r.slice());for(let o=a;o<l;o++)r[o]=n?r.__original__[o]:wt;o(e)})),Qt.getBuffer().opacities.subdata(r,0)},uo=e=>[e%Nn/Nn+$n,Math.floor(e/Nn)/Nn+$n],po=({preventEvent:e=!1}={})=>{"deselect"===k&&lo(),qt.length&&(e||r.publish("deselect"),Ht.clear(),co(qt,0),qt=[],Gt.clear(),wn=!0)},mo=(e,{merge:t=!1,preventEvent:n=!1}={})=>{const o=Array.isArray(e)?e:[e];t?qt=E(qt,o):(qt&&qt.length&&co(qt,0),qt=o);const i=[];Gt.clear(),Ht.clear();for(let r=qt.length-1;r>=0;r--){const e=qt[r];if(e<0||e>=pn)qt.splice(r,1);else{Gt.add(e);const t=uo(e);i.push(t[0]),i.push(t[1])}}An({usage:"dynamic",type:"float",data:i}),co(qt,1),n||r.publish("select",{points:qt}),wn=!0},ho=e=>{const t=p.getBoundingClientRect();return s[0]=e.clientX-t.left,s[1]=e.clientY-t.top,[...s]},go=ut(p,{onStart:()=>{Wt.config({isFixed:!0}),Vt=!0,hn=!0,lo(),r.publish("lassoStart")},onDraw:(e,t)=>{gn=e,jt.setPoints(t),r.publish("lassoExtend",{coordinates:e})},onEnd:(e,t,{merge:n=!1}={})=>{Wt.config({isFixed:!1}),gn=[...e];const o=(e=>{const t=(e=>{let t=1/0,n=-1/0,o=1/0,i=-1/0;for(let r=0;r<e.length;r+=2)t=e[r]<t?e[r]:t,n=e[r]>n?e[r]:n,o=e[r+1]<o?e[r+1]:o,i=e[r+1]>i?e[r+1]:i;return[t,o,n,i]})(e),n=Kt.range(...t),o=[];return n.forEach((t=>{((e,[t,n]=[])=>{let o,i,r,a,l=!1;for(let s=0,c=e.length-2;s<e.length;s+=2)o=e[s],i=e[s+1],r=e[c],a=e[c+1],i>n!=a>n&&t<(r-o)*(n-i)/(a-i)+o&&(l=!l),c=s;return l})(e,Kt.points[t])&&o.push(t)})),o})(t);mo(o,{merge:n}),r.publish("lassoEnd",{coordinates:gn}),"lassoEnd"===k&&lo()},enableInitiator:_,initiatorParentElement:ee,pointNorm:([e,t])=>io(no(e),oo(t))}),yo=(e,t)=>{switch(vn[t]){case"alt":return e.altKey;case"cmd":return e.metaKey;case"ctrl":return e.ctrlKey;case"meta":return e.metaKey;case"shift":return e.shiftKey;default:return!1}},vo=e=>{Gn&&(Vt=!0,dn=performance.now(),un=ho(e),hn="lasso"===Ge||yo(e,"lasso"))},fo=e=>{Gn&&(Vt=!1,hn&&(e.preventDefault(),hn=!1,go.end({merge:yo(e,"merge")})))},wo=e=>{if(!Gn)return;e.preventDefault();const t=ho(e);if($e(...t,...un)>=b)return;const n=performance.now()-dn;if(_&&n>500)go.showInitiator(e);else{const t=ao();t>=0?(qt.length&&"deselect"===k&&lo(),mo([t],{merge:yo(e,"merge")})):an||(an=setTimeout((()=>{an=null,go.showInitiator(e)}),200))}},xo=e=>{go.hideInitiator(),an&&(clearTimeout(an),an=null),g&&(e.preventDefault(),po())},bo=e=>{Gn&&(Yn||Vt)&&(ho(e),Yn&&!hn&&Xi(ao()),hn&&(e.preventDefault(),go.extend(e,!0)),Vt&&(wn=!0))},So=()=>{Gn&&(+_n>=0&&!Gt.has(_n)&&co([_n],0),_n=void 0,Yn=!1,fo(),wn=!0)},Co=()=>{const e=Math.max(It.length,Pt.length);Vn=Math.max(2,Math.ceil(Math.sqrt(e)));const t=new Float32Array(Vn**2*4);for(let n=0;n<e;n++){t[4*n]=It[n]||0,t[4*n+1]=Math.min(1,Pt[n]||0);const e=Number((it[n]||it[0])[3]);t[4*n+2]=Math.min(1,Number.isNaN(e)?1:e);const o=Number((rt[n]||rt[0])[3]);t[4*n+3]=Math.min(1,Number.isNaN(o)?1:o)}return c.regl.texture({data:t,shape:[Vn,Vn,4],type:"float"})},Eo=(e=Xe,t=it,n=rt)=>{const o=e.length,i=t.length,r=n.length,a=[];if(o===i&&i===r)for(let l=0;l<o;l++)a.push(e[l],t[l],n[l],d);else for(let l=0;l<o;l++){const o=[e[l][0],e[l][1],e[l][2],1],i=m===ye?t[0]:o,r=m===ye?n[0]:o;a.push(e[l],i,r,d)}return a},Io=()=>{const e=Eo(),t=e.length;Zn=Math.max(2,Math.ceil(Math.sqrt(t)));const n=new Float32Array(Zn**2*4);return e.forEach(((e,t)=>{n[4*t]=e[0],n[4*t+1]=e[1],n[4*t+2]=e[2],n[4*t+3]=e[3]})),c.regl.texture({data:n,shape:[Zn,Zn,4],type:"float"})},Mo=()=>{Yt=_t/Nt,Xt=R([],[1/Yt,1,1]),Ut=R([],[1/Yt,1,1]),Jt=R([],[yn,1,1])},Ao=(e,t)=>n=>{if(!n||!n.length)return;const o=[...e()];let i=Ue(n)?n:[n];i=i.map((e=>et(e,!0))),Ln&&Ln.destroy();try{t(i),Ln=Io()}catch(r){console.error("Invalid colors. Switching back to default colors."),t(o),Ln=Io()}},Ro=Ao((()=>Xe),(e=>{Xe=e})),Po=Ao((()=>it),(e=>{it=e})),To=Ao((()=>rt),(e=>{rt=e})),zo=()=>{if(!Xn&&!Un)return;const[e,t]=(()=>{const e=io(-1,-1),t=io(1,1),n=(e[0]+1)/2,o=(t[0]+1)/2,i=(e[1]+1)/2,r=(t[1]+1)/2;return[[Jn+n*Qn,Jn+o*Qn],[eo+i*to,eo+r*to]]})();Xn&&Xn.domain(e),Un&&Un.domain(t)},Bo=e=>{Nt=e,p.height=Math.floor(Nt*window.devicePixelRatio),Un&&(Un.range([Nt,0]),zo())},Do=()=>{rn=At,At===O&&(rn=Array.isArray(It)?It[Math.floor(It.length/2)]:It)},Oo=e=>{_t=e,p.width=Math.floor(_t*window.devicePixelRatio),Xn&&(Xn.range([0,_t]),zo())},Lo=e=>{switch(e){case"valueZ":return Hn>1?"categorical":"continuous";case"valueW":return Kn>1?"categorical":"continuous";default:return null}},ko=(e,t)=>{switch(e){case"continuous":return e=>Math.round(e*(t.length-1));case"categorical":default:return h}},_o=()=>[p.width,p.height],No=()=>Ln,$o=()=>Zn,Fo=()=>.5/Zn,Wo=()=>window.devicePixelRatio,jo=()=>An,Zo=()=>kn,Vo=()=>Vn,qo=()=>.5/Vn,Go=()=>0,Ho=()=>Cn||bn,Ko=()=>Nn,Yo=()=>.5/Nn,Xo=()=>Ut,Uo=()=>Wt.view,Jo=()=>Jt,Qo=()=>M(l,Ut,M(l,Wt.view,Jt)),ei=()=>Wt.scaling[0]>1?Math.asinh(Je(1,Wt.scaling[0]))/Math.asinh(1)*window.devicePixelRatio:Je(In,Wt.scaling[0])*window.devicePixelRatio,ti=()=>qt.length,ni=()=>ti()>0?Bt:1,oi=()=>ti()>0?Dt:1,ii=()=>+("valueZ"===m),ri=()=>+("valueW"===m),ai=()=>+("valueZ"===Tt),li=()=>+("valueW"===Tt),si=()=>+("density"===Tt),ci=()=>+("valueZ"===Ot),di=()=>+("valueW"===Ot),ui=()=>"valueZ"===m?Hn<=1?Xe.length-1:1:Kn<=1?Xe.length-1:1,pi=()=>"valueZ"===Tt?Hn<=1?Pt.length-1:1:Kn<=1?Pt.length-1:1,mi=()=>"valueZ"===Ot?Hn<=1?It.length-1:1:Kn<=1?It.length-1:1,hi=e=>{if("density"!==Tt)return 1;const t=ei(),n=It[0]*t,o=2/(2/Wt.view[0])*(2/(2/Wt.view[5])),i=e.viewportHeight,r=e.viewportWidth;let a=zt*r*i/(mn*n*n)*Qe(1,o);a*=$t?1:1/(.25*Math.PI);return a*=(n/(Je(1,n)+.5))**2,Qe(1,Je(0,a))},gi=c.regl({framebuffer:()=>En,vert:"precision highp float;\n\nattribute vec2 position;\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // map normalized device coords to texture coords\n  particleTextureIndex = 0.5 * (1.0 + position);\n\n  gl_Position = vec4(position, 0, 1);\n}",frag:"precision highp float;\n\nuniform sampler2D startStateTex;\nuniform sampler2D endStateTex;\nuniform float t;\n\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // Interpolate x, y, and value\n  vec3 start = texture2D(startStateTex, particleTextureIndex).xyw;\n  vec3 end = texture2D(endStateTex, particleTextureIndex).xyw;\n  vec3 curr = start * (1.0 - t) + end * t;\n\n  // The category cannot be interpolated\n  float endCategory = texture2D(endStateTex, particleTextureIndex).z;\n\n  gl_FragColor = vec4(curr.xy, endCategory, curr.z);\n}",attributes:{position:[-4,0,4,4,4,-4]},uniforms:{startStateTex:()=>Sn,endStateTex:()=>bn,t:(e,t)=>t.t},count:3}),yi=(e,t,n,o=0,i=ni,r=oi)=>c.regl({frag:$t?"precision highp float;\n\nvarying vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n":"\nprecision highp float;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nfloat linearstep(float edge0, float edge1, float x) {\n  return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\nvoid main() {\n  vec2 c = gl_PointCoord * 2.0 - 1.0;\n  float sdf = length(c) * finalPointSize;\n  float alpha = linearstep(finalPointSize + 0.5, finalPointSize - 0.5, sdf);\n\n  gl_FragColor = vec4(color.rgb, alpha * color.a);\n}\n",vert:pt(o),blend:{enable:!$t,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},depth:{enable:!1},attributes:{stateIndex:{buffer:n,size:2}},uniforms:{resolution:_o,modelViewProjection:Qo,devicePixelRatio:Wo,pointScale:ei,encodingTex:Zo,encodingTexRes:Vo,encodingTexEps:qo,pointOpacityMax:i,pointOpacityScale:r,pointSizeExtra:e,globalState:o,colorTex:No,colorTexRes:$o,colorTexEps:Fo,stateTex:Ho,stateTexRes:Ko,stateTexEps:Yo,isColoredByZ:ii,isColoredByW:ri,isOpacityByZ:ai,isOpacityByW:li,isOpacityByDensity:si,isSizedByZ:ci,isSizedByW:di,colorMultiplicator:ui,opacityMultiplicator:pi,opacityDensity:hi,sizeMultiplicator:mi,numColorStates:4},count:t,primitive:"points"}),vi=yi(Go,(()=>pn),(()=>Mn)),fi=yi(Go,(()=>1),(()=>Rn),2,(()=>1),(()=>1)),wi=yi((()=>(Mt+2*Rt)*window.devicePixelRatio),ti,jo,1,(()=>1),(()=>1)),xi=yi((()=>(Mt+Rt)*window.devicePixelRatio),ti,jo,3,(()=>1),(()=>1)),bi=yi((()=>Mt*window.devicePixelRatio),ti,jo,1,(()=>1),(()=>1)),Si=c.regl({frag:"\nprecision mediump float;\n\nuniform sampler2D texture;\n\nvarying vec2 uv;\n\nvoid main () {\n  gl_FragColor = texture2D(texture, uv);\n}\n",vert:"\nprecision mediump float;\n\nuniform mat4 modelViewProjection;\n\nattribute vec2 position;\n\nvarying vec2 uv;\n\nvoid main () {\n  uv = position;\n  gl_Position = modelViewProjection * vec4(-1.0 + 2.0 * uv.x, 1.0 - 2.0 * uv.y, 0, 1);\n}\n",attributes:{position:[0,1,0,0,1,0,0,1,1,1,1,0]},uniforms:{modelViewProjection:Qo,texture:()=>u},count:6}),Ci=c.regl({vert:"\n      precision mediump float;\n      uniform mat4 modelViewProjection;\n      attribute vec2 position;\n      void main () {\n        gl_Position = modelViewProjection * vec4(position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform vec4 color;\n      void main () {\n        gl_FragColor = vec4(color.rgb, 0.2);\n      }",depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},attributes:{position:()=>gn},uniforms:{modelViewProjection:Qo,color:()=>v},elements:()=>Array.from({length:gn.length-2},((e,t)=>[0,t+1,t+2]))}),Ei=e=>{const t=new Float32Array(2*e);let n=0;for(let o=0;o<e;++o){const e=uo(o);t[n]=e[0],t[n+1]=e[1],n+=2}return t},Ii=e=>{const t=e.length;Nn=Math.max(2,Math.ceil(Math.sqrt(t))),$n=.5/Nn;const n=new Float32Array(Nn**2*4);Hn=0,Kn=0;for(let o=0;o<t;++o)n[4*o]=e[o][0],n[4*o+1]=e[o][1],n[4*o+2]=e[o][2]||0,n[4*o+3]=e[o][3]||0,Hn=Math.max(Hn,n[4*o+2]),Kn=Math.max(Kn,n[4*o+3]);return c.regl.texture({data:n,shape:[Nn,Nn,4],type:"float"})},Mi=e=>{Gn=!1,pn=e.length,mn=pn,bn&&bn.destroy(),bn=Ii(e),Mn({usage:"static",type:"float",data:Ei(pn)}),Kt=new P(e,(e=>e[0]),(e=>e[1]),16),Gn=!0},Ai=(e,t)=>{Pn=Wt.target,Tn=e,zn=Wt.distance[0],Bn=t},Ri=e=>{const t="inherit"===dt?m:dt;if("segment"===t){const t=lt.length-1;return t<1?[]:e.reduce(((e,n,o)=>{let i=0;const r=[];for(let t=2;t<n.length;t+=2){const e=Math.sqrt((n[t-2]-n[t])**2+(n[t-1]-n[t+1])**2);r.push(e),i+=e}e[o]=[0];let a=0;for(let l=0;l<n.length/2-1;l++)a+=r[l],e[o].push(4*Math.floor(a/i*t));return e}),[])}if(t){const e=vt(t),n=ko(Lo(t),"inherit"===dt?Xe:lt);return en.reduce(((t,[o,i])=>(t[o]=4*n(i[e]),t)),[])}return Array(en.length).fill(0)},Pi=()=>{const e="inherit"===ft?Tt:ft;if("segment"===e){const e=ht.length-1;return e<1?[]:en.reduce(((t,[n,o,i])=>(t[n]=T(i,(t=>ht[Math.floor(t/(i-1)*e)])),t)),[])}if(e){const t=vt(e),n="inherit"===ft?Pt:ht,o=ko(Lo(e),n);return en.reduce(((e,[i,r])=>(e[i]=n[o(r[t])],e)),[])}},Ti=()=>{const e="inherit"===St?Ot:St;if("segment"===e){const e=xt.length-1;return e<1?[]:en.reduce(((t,[n,o,i])=>(t[n]=T(i,(t=>xt[Math.floor(t/(i-1)*e)])),t)),[])}if(e){const t=vt(e),n="inherit"===St?It:xt,o=ko(Lo(e),n);return en.reduce(((e,[i,r])=>(e[i]=n[o(r[t])],e)),[])}},zi=e=>new Promise((t=>{Qt.setPoints([]),e&&e.length?(tn=!0,((e,t={tolerance:.002,maxIntPointsPerSegment:100})=>new Promise(((n,o)=>{const i=S(mt);i.onmessage=e=>{e.data.error?o(e.data.error):n(e.data.points),i.terminate()},i.postMessage({points:e,options:t})})))(e,{maxIntPointsPerSegment:Ct,tolerance:Et}).then((e=>{(e=>{en=[];let t=0;Object.keys(e).forEach(((n,o)=>{en[n]=[o,e[n].reference,e[n].length/2,t],t+=e[n].length/2}))})(e);const n=Object.values(e);Qt.setPoints(n,{colorIndices:Ri(n),opacities:Pi(),widths:Ti()}),tn=!1,t()}))):t()})),Bi=()=>Kt.range(sn[0],sn[1],ln[0],ln[1]),Di=f((()=>{mn=Bi().length}),Ft),Oi=()=>Boolean(Sn&&Cn),Li=()=>Boolean(void 0!==Pn&&void 0!==Tn&&void 0!==zn&&void 0!==Bn),ki=(e,t)=>{Wn||(Wn=performance.now());const n=performance.now()-Wn,o=(i=t(n/e),r=0,a=1,Math.min(a,Math.max(r,i)));var i,r,a;return Oi()&&gi({t:o}),Li()&&(e=>{const[t,n]=Pn,[o,i]=Tn,r=1-e,a=t*r+o*e,l=n*r+i*e,s=zn*r+Bn*e;Wt.lookAt([a,l],s)})(o),n<e},_i=()=>{Fn=!1,Wn=null,Dn=void 0,On=void 0,He=jn,Sn&&(Sn.destroy(),Sn=void 0),Cn&&(Cn.destroy(),Cn=void 0),Pn=void 0,Tn=void 0,zn=void 0,Bn=void 0,r.publish("transitionEnd")},Ni=({duration:e=500,easing:t=W})=>{Fn&&r.publish("transitionEnd"),Fn=!0,Wn=null,Dn=e,On=Ke(t)?F[t]||W:t,jn=He,He=!1,r.publish("transitionStart")},$i=e=>(...t)=>{const n=e(...t);return wn=!0,n},Fi=(e,t={})=>new Promise((n=>{const o=[e.x+e.width/2,e.y+e.height/2],i=2*Math.atan(1/Wt.view[5]),a=e.height*Yt>e.width?e.height/2/Math.tan(i/2):e.width/2/Math.tan(i*Yt/2);t.transition?(Wt.config({isFixed:!0}),Ai(o,a),r.subscribe("transitionEnd",(()=>{n(),Wt.config({isFixed:!1})}),1),Ni({duration:t.transitionDuration,easing:t.transitionEasing})):(Wt.lookAt(o,a),r.subscribe("draw",n,1),wn=!0)})),Wi=(e,t,n={})=>new Promise((o=>{n.transition?(Wt.config({isFixed:!0}),Ai(e,t),r.subscribe("transitionEnd",(()=>{o(),Wt.config({isFixed:!1})}),1),Ni({duration:n.transitionDuration,easing:n.transitionEasing})):(Wt.lookAt(e,t),r.subscribe("draw",o,1),wn=!0)})),ji=()=>{Qt.setStyle({color:Eo(lt,st,ct),opacity:null===ht?null:ht[0],width:xt[0]})},Zi=()=>{const e=Math.round(Zt)>0?0:255;go.initiator.style.border=`1px dashed rgba(${e}, ${e}, ${e}, 0.33)`,go.initiator.style.background=`rgba(${e}, ${e}, ${e}, 0.1)`},Vi=e=>{e&&Wt.setView(e)},qi=(e,t)=>n=>{if("inherit"===n)e([...t()]);else{const t=Ue(n)?n:[n];e(t.map((e=>et(e,!0))))}ji()},Gi=qi((e=>{lt=e}),(()=>Xe)),Hi=qi((e=>{st=e}),(()=>it)),Ki=qi((e=>{ct=e}),(()=>rt)),Yi=(e={})=>{var t,n,o,i,a,l,s,h,f,S,C,E,I,M,A,R,P,T,z,B,D,L,$,F,W,Z,V,q,G,H,K,U,J,Q,te,ne;return gt(e),void 0===e.backgroundColor&&void 0===e.background||(t=e.backgroundColor||e.background)&&(d=et(t,!0),Zt=nt(d),Zi()),void 0!==e.backgroundImage&&((n=e.backgroundImage)?Ke(n)?qe(c.regl,n).then((e=>{u=e,wn=!0,r.publish("backgroundImageReady")})):u="texture2d"===n._reglType?n:null:u=null),void 0!==e.cameraTarget&&(o=e.cameraTarget)&&Wt.lookAt(o,Wt.distance[0],Wt.rotation),void 0!==e.cameraDistance&&(i=e.cameraDistance)>0&&Wt.lookAt(Wt.target,i,Wt.rotation),void 0!==e.cameraRotation&&null!==(a=e.cameraRotation)&&Wt.lookAt(Wt.target,Wt.distance[0],a),void 0!==e.cameraView&&Vi(e.cameraView),void 0!==e.colorBy&&(l=e.colorBy,m=yt(l,ye)),void 0!==e.pointColor&&Ro(e.pointColor),void 0!==e.pointColorActive&&Po(e.pointColorActive),void 0!==e.pointColorHover&&To(e.pointColorHover),void 0!==e.pointSize&&(s=e.pointSize,We(s,je,{minLength:1})&&(It=[...s]),Ze(+s)&&(It=[+s]),In=1/It[0],kn=Co(),Do()),void 0!==e.pointSizeSelected&&(!+(h=e.pointSizeSelected)||+h<0||(Mt=+h)),void 0!==e.pointSizeMouseDetection&&(f=e.pointSizeMouseDetection,At=f,Do()),void 0!==e.sizeBy&&(e=>{Ot=yt(e,ie)})(e.sizeBy),void 0!==e.opacity&&(S=e.opacity,We(S,je,{minLength:1})&&(Pt=[...S]),Ze(+S)&&(Pt=[+S]),kn=Co()),void 0!==e.showPointConnections&&(C=e.showPointConnections,at=!!C,at?so(Kt.points[0])&&zi(Kt.points).then((()=>{r.publish("pointConnectionsDraw"),wn=!0})):zi()),void 0!==e.pointConnectionColor&&Gi(e.pointConnectionColor),void 0!==e.pointConnectionColorActive&&Hi(e.pointConnectionColorActive),void 0!==e.pointConnectionColorHover&&Ki(e.pointConnectionColorHover),void 0!==e.pointConnectionColorBy&&(e=>{dt=yt(e,be,{allowSegment:!0})})(e.pointConnectionColorBy),void 0!==e.pointConnectionOpacityBy&&(e=>{ft=yt(e,ce,{allowSegment:!0})})(e.pointConnectionOpacityBy),void 0!==e.pointConnectionOpacity&&(e=>{We(e,je,{minLength:1})&&(ht=[...e]),Ze(+e)&&(ht=[+e]),lt=lt.map((e=>(e[3]=Number.isNaN(+ht[0])?e[3]:+ht[0],e))),ji()})(e.pointConnectionOpacity),void 0!==e.pointConnectionOpacityActive&&(e=>{!Number.isNaN(+e)&&+e&&(wt=+e)})(e.pointConnectionOpacityActive),void 0!==e.pointConnectionSize&&(E=e.pointConnectionSize,We(E,je,{minLength:1})&&(xt=[...E]),Ze(+E)&&(xt=[+E]),ji()),void 0!==e.pointConnectionSizeActive&&(I=e.pointConnectionSizeActive,!Number.isNaN(+I)&&+I&&(bt=Math.max(0,I))),void 0!==e.pointConnectionSizeBy&&(e=>{St=yt(e,le,{allowSegment:!0})})(e.pointConnectionSizeBy),void 0!==e.pointConnectionMaxIntPointsPerSegment&&(M=e.pointConnectionMaxIntPointsPerSegment,Ct=Math.max(0,M)),void 0!==e.pointConnectionTolerance&&(A=e.pointConnectionTolerance,Et=Math.max(0,A)),void 0!==e.opacityBy&&(e=>{Tt=yt(e,ue,{allowDensity:!0})})(e.opacityBy),void 0!==e.lassoColor&&(R=e.lassoColor)&&(v=et(R,!0),jt.setStyle({color:v})),void 0!==e.lassoLineWidth&&(P=e.lassoLineWidth,Number.isNaN(+P)||+P<1||(w=+P,jt.setStyle({width:w}))),void 0!==e.lassoMinDelay&&+(T=e.lassoMinDelay)&&(x=+T,go.set({minDelay:x})),void 0!==e.lassoMinDist&&+(z=e.lassoMinDist)&&(b=+z,go.set({minDist:b})),void 0!==e.lassoClearEvent&&(B=e.lassoClearEvent,k=Ve(j,k)(B)),void 0!==e.lassoInitiator&&(D=e.lassoInitiator,_=Boolean(D),go.set({enableInitiator:_})),void 0!==e.lassoInitiatorParentElement&&(L=e.lassoInitiatorParentElement,ee=L,go.set({startInitiatorParentElement:ee})),void 0!==e.keyMap&&($=e.keyMap,Fe=Object.entries($).reduce(((e,[t,n])=>(X.includes(t)&&Y.includes(n)&&(e[t]=n),e)),{}),vn=tt(Fe),vn.rotate?Wt.config({isRotate:!0,mouseDownMoveModKey:vn.rotate}):Wt.config({isRotate:!1})),void 0!==e.mouseMode&&(F=e.mouseMode,Ge=Ve(N,"panZoom")(F),Wt.config({defaultMouseDownMoveAction:"rotate"===Ge?"rotate":"pan"})),void 0!==e.showReticle&&null!==(W=e.showReticle)&&(He=W),void 0!==e.reticleColor&&(Z=e.reticleColor)&&(Ye=et(Z,!0),nn.setStyle({color:Ye}),on.setStyle({color:Ye})),void 0!==e.pointOutlineWidth&&(!+(V=e.pointOutlineWidth)||+V<0||(Rt=+V)),void 0!==e.height&&(e=>{if(e===O)return Lt=e,p.style.height="100%",void window.requestAnimationFrame((()=>{p&&Bo(p.getBoundingClientRect().height)}));!+e||+e<=0||(Lt=+e,Bo(Lt),p.style.height=`${Lt}px`)})(e.height),void 0!==e.width&&(e=>{if(e===O)return kt=e,p.style.width="100%",void window.requestAnimationFrame((()=>{p&&Oo(p.getBoundingClientRect().width)}));!+e||+e<=0||(kt=+e,Oo(kt),p.style.width=`${_t}px`)})(e.width),void 0!==e.aspectRatio&&(+(q=e.aspectRatio)<=0||(yn=q)),void 0!==e.xScale&&(G=e.xScale)&&(Xn=G,Jn=G.domain()[0],Qn=G?G.domain()[1]-G.domain()[0]:0,Xn.range([0,_t]),zo()),void 0!==e.yScale&&(H=e.yScale)&&(Un=H,eo=Un.domain()[0],to=Un?Un.domain()[1]-Un.domain()[0]:0,Un.range([Nt,0]),zo()),void 0!==e.deselectOnDblClick&&(K=e.deselectOnDblClick,g=!!K),void 0!==e.deselectOnEscape&&(U=e.deselectOnEscape,y=!!U),void 0!==e.opacityByDensityFill&&(J=e.opacityByDensityFill,zt=+J),void 0!==e.opacityInactiveMax&&(Q=e.opacityInactiveMax,Bt=+Q),void 0!==e.opacityInactiveScale&&(te=e.opacityInactiveScale,Dt=+te),void 0!==e.gamma&&(ne=e.gamma,c.gamma=ne),new Promise((e=>{window.requestAnimationFrame((()=>{p&&(Mo(),Wt.refresh(),c.refresh(),wn=!0,e())}))}))},Xi=(e,{showReticleOnce:t=!1,preventEvent:n=!1}={})=>{let o=!1;if(e>=0&&e<pn){o=!0;const t=_n,i=e!==_n;+t>=0&&i&&!Gt.has(t)&&co([t],0),_n=e,Rn.subdata(uo(e)),Gt.has(e)||co([e],2),i&&!n&&r.publish("pointover",_n)}else o=+_n>=0,o&&(Gt.has(_n)||co([_n],0),n||r.publish("pointout",_n)),_n=void 0;o&&(wn=!0,xn=t)},Ui=()=>{Wt||(Wt=z(p,{isPanInverted:[!1,!0]})),e.cameraView?Wt.setView(B(e.cameraView)):e.cameraTarget||e.cameraDistance||e.cameraRotation?Wt.lookAt([...e.cameraTarget||Ie],e.cameraDistance||1,e.cameraRotation||0):Wt.setView(B(Me)),ln=io(1,1),sn=io(-1,-1)},Ji=({key:e})=>{switch(e){case"Escape":y&&po()}},Qi=()=>{Yn=!0},er=()=>{Xi(),Yn=!1,wn=!0},tr=()=>{wn=!0},nr=()=>{Wt.refresh();const e=kt===O,t=Lt===O;if(e||t){const{width:n,height:o}=p.getBoundingClientRect();e&&Oo(n),t&&Bo(o),Mo(),wn=!0}},or=c.onFrame((()=>{qn=Wt.tick(),Gn&&(wn||Fn)&&(Fn&&!ki(Dn,On)&&_i(),qn&&(ln=io(1,1),sn=io(-1,-1),"density"===Tt&&Di()),c.render(((e,t)=>{((e,t)=>{Ut[0]=e/Yt,Ut[5]=t})(e,t),u&&u._reglType&&Si(),gn.length>2&&Ci(),Fn||Qt.draw({projection:Xo(),model:Jo(),view:Uo()}),vi(),Vt||!He&&!xn||(()=>{if(!(_n>=0))return;const[e,t]=Kt.points[_n].slice(0,2),n=[e,t,0,1];M(a,Ut,M(a,Wt.view,Jt)),A(n,n,a),nn.setPoints([-1,n[1],1,n[1]]),on.setPoints([n[0],1,n[0],-1]),nn.draw(),on.draw(),yi((()=>(Mt+2*Rt)*window.devicePixelRatio),(()=>1),Rn,1)(),yi((()=>(Mt+Rt)*window.devicePixelRatio),(()=>1),Rn,3)()})(),_n>=0&&fi(),qt.length&&(wi(),xi(),bi()),jt.draw({projection:Xo(),model:Jo(),view:Uo()})}),p),qn&&(zo(),fn?fn=!1:r.publish("view",{view:Wt.view,camera:Wt,xScale:Xn,yScale:Un})),wn=!1,xn=!1,r.publish("draw"))}));return(()=>{Mo(),Ui(),zo(),jt=D(c.regl,{color:v,width:w,is2d:!0}),Qt=D(c.regl,{color:lt,colorHover:ct,colorActive:st,opacity:null===ht?null:ht[0],width:xt[0],widthActive:bt,is2d:!0}),nn=D(c.regl,{color:Ye,width:1,is2d:!0}),on=D(c.regl,{color:Ye,width:1,is2d:!0}),Do(),p.addEventListener("wheel",tr),Mn=c.regl.buffer(),An=c.regl.buffer(),Rn=c.regl.buffer({usage:"dynamic",type:"float",length:2*L}),Ln=Io(),kn=Co();const e=Yi({backgroundImage:u,width:kt,height:Lt,keyMap:Fe});Zi(),window.addEventListener("keyup",Ji,!1),window.addEventListener("blur",So,!1),window.addEventListener("mouseup",fo,!1),window.addEventListener("mousemove",bo,!1),p.addEventListener("mousedown",vo,!1),p.addEventListener("mouseenter",Qi,!1),p.addEventListener("mouseleave",er,!1),p.addEventListener("click",wo,!1),p.addEventListener("dblclick",xo,!1),"ResizeObserver"in window?(cn=new ResizeObserver(nr),cn.observe(p)):(window.addEventListener("resize",nr),window.addEventListener("orientationchange",nr)),e.then((()=>{r.publish("init")}))})(),{get isSupported(){return c.isSupported},clear:$i((()=>{Mi([]),Qt.clear()})),createTextureFromUrl:e=>qe(c.regl,e),deselect:po,destroy:()=>{or(),window.removeEventListener("keyup",Ji,!1),window.removeEventListener("blur",So,!1),window.removeEventListener("mouseup",fo,!1),window.removeEventListener("mousemove",bo,!1),p.removeEventListener("mousedown",vo,!1),p.removeEventListener("mouseenter",Qi,!1),p.removeEventListener("mouseleave",er,!1),p.removeEventListener("click",wo,!1),p.removeEventListener("dblclick",xo,!1),cn?cn.disconnect():(window.removeEventListener("resize",nr),window.removeEventListener("orientationchange",nr)),p=void 0,Wt.dispose(),Wt=void 0,jt.destroy(),Qt.destroy(),nn.destroy(),on.destroy(),r.publish("destroy"),r.clear(),e.renderer||c.destroy()},draw:(e,t={})=>{return(n=e,new Promise(((e,t)=>{if(!n||Array.isArray(n))e(n);else{const o=Array.isArray(n.x)||ArrayBuffer.isView(n.x)?n.x.length:0,i=(Array.isArray(n.x)||ArrayBuffer.isView(n.x))&&(e=>n.x[e]),r=(Array.isArray(n.y)||ArrayBuffer.isView(n.y))&&(e=>n.y[e]),a=(Array.isArray(n.line)||ArrayBuffer.isView(n.line))&&(e=>n.line[e]),l=(Array.isArray(n.lineOrder)||ArrayBuffer.isView(n.lineOrder))&&(e=>n.lineOrder[e]),s=Object.keys(n),c=(()=>{const e=s.find((e=>_e.has(e)));return e&&(Array.isArray(n[e])||ArrayBuffer.isView(n[e]))&&(t=>n[e][t])})(),d=(()=>{const e=s.find((e=>Ne.has(e)));return e&&(Array.isArray(n[e])||ArrayBuffer.isView(n[e]))&&(t=>n[e][t])})();i&&r&&c&&d&&a&&l?e(n.x.map(((e,t)=>[e,r(t),c(t),d(t),a(t),l(t)]))):i&&r&&c&&d&&a?e(Array.from({length:o},((e,t)=>[i(t),r(t),c(t),d(t),a(t)]))):i&&r&&c&&d?e(Array.from({length:o},((e,t)=>[i(t),r(t),c(t),d(t)]))):i&&r&&c?e(Array.from({length:o},((e,t)=>[i(t),r(t),c(t)]))):i&&r?e(Array.from({length:o},((e,t)=>[i(t),r(t)]))):t(new Error("You need to specify at least x and y"))}}))).then((e=>new Promise((n=>{let o=!1;e&&(t.transition&&(e.length===pn?o=(e=>{if(!bn)return!1;if(Fn){const e=Sn;Sn=Cn,e.destroy()}else Sn=bn;return Cn=Ii(e),En=c.regl.framebuffer({color:Cn,depth:!1,stencil:!1}),bn=void 0,!0})(e):console.warn("Cannot transition! The number of points between the previous and current draw call must be identical.")),Mi(e),(at||t.showPointConnectionsOnce&&so(e[0]))&&zi(e).then((()=>{r.publish("pointConnectionsDraw"),wn=!0,xn=t.showReticleOnce}))),t.transition&&o?(r.subscribe("transitionEnd",(()=>{wn=!0,xn=t.showReticleOnce,n()}),1),Ni({duration:t.transitionDuration,easing:t.transitionEasing})):(r.subscribe("draw",n,1),wn=!0,xn=t.showReticleOnce)}))));var n},get:e=>(gt({property:!0}),"aspectRatio"===e?yn:"background"===e||"backgroundColor"===e?d:"backgroundImage"===e?u:"camera"===e?Wt:"cameraTarget"===e?Wt.target:"cameraDistance"===e?Wt.distance[0]:"cameraRotation"===e?Wt.rotation:"cameraView"===e?Wt.view:"canvas"===e?p:"colorBy"===e?m:"sizeBy"===e?Ot:"deselectOnDblClick"===e?g:"deselectOnEscape"===e?y:"height"===e?Lt:"lassoColor"===e?v:"lassoLineWidth"===e?w:"lassoMinDelay"===e?x:"lassoMinDist"===e?b:"lassoClearEvent"===e?k:"lassoInitiator"===e?_:"lassoInitiatorElement"===e?go.initiator:"lassoInitiatorParentElement"===e?ee:"keyMap"===e?((e,r)=>{for(var a in r||(r={}))n.call(r,a)&&i(e,a,r[a]);if(t)for(var a of t(r))o.call(r,a)&&i(e,a,r[a]);return e})({},Fe):"mouseMode"===e?Ge:"opacity"===e?1===Pt.length?Pt[0]:Pt:"opacityBy"===e?Tt:"opacityByDensityFill"===e?zt:"opacityByDensityDebounceTime"===e?Ft:"opacityInactiveMax"===e?Bt:"opacityInactiveScale"===e?Dt:"points"===e?Kt.points:"pointsInView"===e?Bi():"pointColor"===e?1===Xe.length?Xe[0]:Xe:"pointColorActive"===e?1===it.length?it[0]:it:"pointColorHover"===e?1===rt.length?rt[0]:rt:"pointOutlineWidth"===e?Rt:"pointSize"===e?1===It.length?It[0]:It:"pointSizeSelected"===e?Mt:"pointSizeMouseDetection"===e?At:"showPointConnections"===e?at:"pointConnectionColor"===e?1===lt.length?lt[0]:lt:"pointConnectionColorActive"===e?1===st.length?st[0]:st:"pointConnectionColorHover"===e?1===ct.length?ct[0]:ct:"pointConnectionColorBy"===e?dt:"pointConnectionOpacity"===e?1===ht.length?ht[0]:ht:"pointConnectionOpacityBy"===e?ft:"pointConnectionOpacityActive"===e?wt:"pointConnectionSize"===e?1===xt.length?xt[0]:xt:"pointConnectionSizeActive"===e?bt:"pointConnectionSizeBy"===e?St:"pointConnectionMaxIntPointsPerSegment"===e?Ct:"pointConnectionTolerance"===e?Et:"reticleColor"===e?Ye:"regl"===e?c.regl:"showReticle"===e?He:"version"===e?"1.4.0":"width"===e?kt:"xScale"===e?Xn:"yScale"===e?Un:"performanceMode"===e?$t:"gamma"===e?c.gamma:"renderer"===e?c:void 0),hover:Xi,redraw:()=>{wn=!0},refresh:c.refresh,reset:$i((({preventEvent:e=!1}={})=>{Ui(),zo(),e||r.publish("view",{view:Wt.view,camera:Wt,xScale:Xn,yScale:Un})})),select:mo,set:Yi,export:()=>p.getContext("2d").getImageData(0,0,p.width,p.height),subscribe:r.subscribe,unsubscribe:r.unsubscribe,view:(e,{preventEvent:t=!1}={})=>{Vi(e),wn=!0,fn=t},zoomToLocation:Wi,zoomToArea:Fi,zoomToPoints:(e,t={})=>{const n=(e=>{let t=1/0,n=-1/0,o=1/0,i=-1/0;for(let r=0;r<e.length;r++){const[a,l]=Kt.points[e[r]];t=Math.min(t,a),n=Math.max(n,a),o=Math.min(o,l),i=Math.max(i,l)}return{x:t,y:o,width:n-t,height:i-o}})(e),o=n.x+n.width/2,i=n.y+n.height/2,r=ro(),a=1+(t.padding||0),l=Math.max(n.width,r)*a,s=Math.max(n.height,r)*a;return Fi({x:o-l/2,y:i-s/2,width:l,height:s},t)},zoomToOrigin:(e={})=>Wi([0,0],1,e)}};function wt(e){const t=new Image;t.onload=()=>{e.get("canvas").toBlob((e=>{!function(e,t="file.txt"){const n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,document.body.appendChild(n),n.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),document.body.removeChild(n)}(e,"scatter.png")}))},t.src=e.get("canvas").toDataURL()}function xt(){const e=document.querySelector("#modal"),t=document.querySelector("#modal-text");e.style.display="none",t.textContent=""}function bt(e,t,n){document.querySelector("#modal").style.display="flex";const o=document.querySelector("#modal-text");o.style.color=t?"#cc79A7":"#bbb",o.textContent=e;const i=document.querySelector("#modal-close");n?(i.style.display="block",i.style.background=t?"#cc79A7":"#bbb",i.addEventListener("click",xt,{once:!0})):i.style.display="none"}function St(e){e.isSupported||bt("Your browser does not support all necessary WebGL features. The scatter plot might not render properly.",!0,!0)}export{St as a,bt as b,ft as c,ot as d,xt as e,wt as s};
